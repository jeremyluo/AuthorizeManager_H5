<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>订单列表</title>
  <link rel="stylesheet" href="../layui/css/layui.css" media="all">
  <style>
    body {
      margin: 10px;
    }

    .background {
      height: 200px;
      line-height: 200px;
      text-align: center;
    }
  </style>
</head>

<body class="layui-layout-body">
  <div class="layui-layout layui-layout-admin">
    <div class="layui-header">
      <div class="layui-logo">订单管理系统</div>
      <!-- 头部区域（可配合layui已有的水平导航） -->
      <ul class="layui-nav layui-layout-left">
        <li class="layui-nav-item layui-nav-itemed">
          <a href="">订单列表</a>
        </li>
        <li class="layui-nav-item">
          <a href="customer.html">客户管理</a>
        </li>
        <!-- <li class="layui-nav-item">
          <a href="user.html">用户管理</a>
        </li>
        <li class="layui-nav-item">
          <a href="">数据上传</a>
        </li>
        <li class="layui-nav-item">
          <a href="javascript:;">其它系统</a>
          <dl class="layui-nav-child">
            <dd>
              <a href="">邮件管理</a>
            </dd>
            <dd>
              <a href="">消息管理</a>
            </dd>
            <dd>
              <a href="">授权管理</a>
            </dd>
          </dl>
        </li> -->
      </ul>
      <ul class="layui-nav layui-layout-right">
        <li class="layui-nav-item">
          <a href="javascript:;">
            <img src="http://t.cn/RCzsdCq" class="layui-nav-img">用户A
          </a>
          <dl class="layui-nav-child">
            <dd>
              <a href="">基本资料</a>
            </dd>
            <dd>
              <a href="">安全设置</a>
            </dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a href="login.html" lay-filter="logout">退了</a>
        </li>
      </ul>
    </div>

    <div class="layui-side layui-bg-black">
      <div class="layui-side-scroll">
      </div>
    </div>

    <div class="layui-body">
      <!-- 内容主体区域 -->
      <table class="layui-hide" id="orderList" lay-filter="orderFunction"></table>
    </div>


    <div class="loading-box">
      <div class="loading">
        <div class="loading-img">
          <img src="images/loading.gif">
        </div>
      </div>
    </div>
  </div>


  <script src="js/common.js"></script>
  <script src="../layui/layui.js"></script>
  <script>
    //JavaScript代码区域
    //默认寻找base也就是js/index.js模块导入
    layui.config({ base: '../res/js/' }).extend({
      cookie: 'module/cookie'
    });
    layui.use(['element', 'form', 'layer', 'table', 'jquery', 'cookie'], function () {
      var element = layui.element
        , form = layui.form
        , table = layui.table
        , layer = layui.layer
        , $ = layui.jquery
        , cookie = layui.cookie;
      // layer.msg('cookie='+$.cookie('the_cookie'));
      //监听提交
      form.on('submit(logout)', function (data) {

        location.href = "login.html";
        return false;
      });

      //执行一个 table 实例
      table.render({
        elem: '#orderList'
        , height: 420
        , url: urlOrderList //数据接口
        , method: 'get'
        , where: { beginDate: '2019-01-01', endDate: '2019-07-01', isClose: '1' }
        , headers: { token: $.cookie('the_cookie'), userName: $.cookie('userName') }
        , title: '订单表'
        , page: true //开启分页
        , toolbar: 'default' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
        , totalRow: false //开启合计行
        , limit: 100
        , limits: [10, 20, 50, 100]
        , request: {
          pageName: 'pageNo',
          limitName: 'pageSize'
        }
        , parseData: function (res) { //res 即为原始返回的数据
          return {
            "code": res.code, //解析接口状态
            "msg": "msg", //解析提示文本
            "count": res.data.total, //解析数据长度
            "data": res.data.list //解析数据列表
          };
        }
        , cols: [[ //表头
          { type: 'checkbox', fixed: 'left' }
          , { field: 'companyName', title: '客户名', width: 120 }
          , { field: 'licenceCount', title: '总数', width: 70, sort: true, totalRow: true }
          , { field: 'activateCount', title: '已激活数', width: 100, sort: true }
          , { field: 'orderDate', title: '订单日期', width: 120, sort: true, totalRow: true }
          , { field: 'key1', title: 'Key1', width: 300 }
          , { field: 'orderId', title: '订单号', width: 260, sort: true, totalRow: true}
        ]]
      });

      //监听头工具栏事件
      table.on('toolbar(orderFunction)', function (obj) {
        var checkStatus = table.checkStatus(obj.config.id)
          , data = checkStatus.data; //获取选中的数据
        switch (obj.event) {
          case 'add':
            layer.msg('添加');
            layer.open({
              type: 2,
              title: '订单添加',
              content: ['orderAdd.html', 'no'],
              area: ['400px', '500px'],
              end: function () {
                window.parent.layer.msg('新增后关闭成功');
                table.reload('orderList', { page: { curr: 1 } });
              }
            });
            break;
          case 'update':
            if (data.length === 0) {
              // layer.msg('请选择一行');
              layer.msg('cookie=' + $.cookie('the_cookie'));
              layer.open({
                type: 2,
                title: '订单修改',
                content: ['orderEdit.html?id=123&customerName=customer123&chipSn=SN123&licenceCount=100&dateStr=2019-06-06&key1=keykeykey1'],
                area: ['400px', '500px'],
                end: function () {
                  window.parent.layer.msg('修改后关闭成功');
                  table.reload('customerList', { page: { curr: 1 } });
                }
              });
            } else if (data.length > 1) {
              layer.msg('只能同时编辑一个');
            } else {
              layer.open({
                type: 2,
                title: '订单修改',
                content: ['orderEdit.html?orderId='+checkStatus.data[0].orderId
                +'&companyName='+encodeURI(checkStatus.data[0].companyName)
                +'&licenceCount='+checkStatus.data[0].licenceCount
                +'&orderDate='+checkStatus.data[0].orderDate
                +'&checkStatus='+checkStatus.data[0].checkStatus
                +'&key1='+checkStatus.data[0].key1],
                area: ['400px', '500px'],
                end: function () {
                  window.parent.layer.msg('修改后关闭成功');
                  table.reload('orderList', { page: { curr: 1 } });
                }
              });
            }
            break;
          case 'delete':
            if (data.length === 0) {
              layer.msg('请选择一行');
            } else {
              layer.msg('删除');
            }
            break;
        };
      });
    });
  </script>
</body>

</html>